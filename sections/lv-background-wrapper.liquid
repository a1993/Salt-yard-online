{% comment %}
  背景包装器分区
  Background Wrapper Section
  
  可在所有页面使用的背景包装器，支持单色和渐变背景配置
  运营人员可以配置全景背景色，支持渐变和单色，渐变支持多个角度
{% endcomment %}

{%- liquid
  comment
    构建背景样式
  endcomment
  assign background_style = ''
  if section.settings.background_type == 'gradient' and section.settings.background_gradient != blank
    assign gradient_angle = section.settings.gradient_angle | default: 90
    assign gradient_value = section.settings.background_gradient
    
    comment
      Shopify的color_background返回格式通常是: linear-gradient(to direction, color1, color2, ...)
      或者只是颜色值。我们需要提取颜色并应用自定义角度
    endcomment
    if gradient_value contains 'linear-gradient'
      comment
        提取括号内的内容（颜色部分）
        格式可能是: linear-gradient(to right, #667eea, #764ba2, #f093fb)
        或: linear-gradient(90deg, #667eea, #764ba2)
      endcomment
      assign gradient_content = gradient_value | split: '(' | last | split: ')' | first
      comment
        移除方向关键词，只保留颜色
      endcomment
      assign gradient_content = gradient_content | replace: 'to right,', '' | replace: 'to bottom,', '' | replace: 'to left,', '' | replace: 'to top,', '' | replace: 'to right', '' | replace: 'to bottom', '' | replace: 'to left', '' | replace: 'to top', ''
      comment
        移除可能的角度值（如 90deg, 180deg等）
      endcomment
      assign color_parts = gradient_content | split: ','
      assign clean_colors = ''
      for part in color_parts
        assign part_clean = part | strip
        unless part_clean contains 'deg' or part_clean == 'to right' or part_clean == 'to bottom' or part_clean == 'to left' or part_clean == 'to top' or part_clean == '' or part_clean == blank
          if clean_colors == '' or clean_colors == blank
            assign clean_colors = part_clean
          else
            assign clean_colors = clean_colors | append: ', ' | append: part_clean
          endif
        endunless
      endfor
      comment
        如果清理后为空，使用原始内容（去除linear-gradient部分）
      endcomment
      if clean_colors == '' or clean_colors == blank
        assign clean_colors = gradient_content
      endif
      comment
        构建新的渐变字符串
      endcomment
      assign background_style = 'linear-gradient(' | append: gradient_angle | append: 'deg, ' | append: clean_colors | append: ')'
    else
      comment
        只是颜色值，直接构建渐变
      endcomment
      assign background_style = 'linear-gradient(' | append: gradient_angle | append: 'deg, ' | append: gradient_value | append: ')'
    endif
  elsif section.settings.background_type == 'solid' and section.settings.background_color != blank
    assign background_style = section.settings.background_color
  endif
  
  comment
    获取间距和内边距设置
  endcomment
  assign padding_top = section.settings.padding_top | default: 0
  assign padding_bottom = section.settings.padding_bottom | default: 0
  assign padding_left = section.settings.padding_left | default: 0
  assign padding_right = section.settings.padding_right | default: 0
-%}

{%- style -%}
  #{{ section.id }} {
    {% if background_style != blank %}
      background: {{ background_style }} !important;
    {% endif %}
    {% if padding_top > 0 %}
      padding-top: {{ padding_top }}px;
    {% endif %}
    {% if padding_bottom > 0 %}
      padding-bottom: {{ padding_bottom }}px;
    {% endif %}
    {% if padding_left > 0 %}
      padding-left: {{ padding_left }}px;
    {% endif %}
    {% if padding_right > 0 %}
      padding-right: {{ padding_right }}px;
    {% endif %}
    width: 100%;
    min-height: 100%;
    position: relative;
  }
  
  @media screen and (max-width: 767px) {
    #{{ section.id }} {
      {% if section.settings.padding_top_mobile > 0 %}
        padding-top: {{ section.settings.padding_top_mobile }}px;
      {% endif %}
      {% if section.settings.padding_bottom_mobile > 0 %}
        padding-bottom: {{ section.settings.padding_bottom_mobile }}px;
      {% endif %}
      {% if section.settings.padding_left_mobile > 0 %}
        padding-left: {{ section.settings.padding_left_mobile }}px;
      {% endif %}
      {% if section.settings.padding_right_mobile > 0 %}
        padding-right: {{ section.settings.padding_right_mobile }}px;
      {% endif %}
    }
  }
{%- endstyle -%}

<div id="{{ section.id }}" class="background-wrapper-section"{% if background_style != blank %} style="background: {{ background_style }};"{% endif %} {{ section.shopify_attributes }}>
  {% if section.blocks.size > 0 %}
    {% for block in section.blocks %}
      {% case block.type %}
        {% when 'content' %}
          <div class="background-wrapper-content" {{ block.shopify_attributes }}>
            {{ block.settings.content }}
          </div>
        {% when 'html' %}
          <div class="background-wrapper-html" {{ block.shopify_attributes }}>
            {{ block.settings.html_content }}
          </div>
        {% when 'liquid' %}
          <div class="background-wrapper-liquid" {{ block.shopify_attributes }}>
            {{ block.settings.liquid_content }}
          </div>
      {% endcase %}
    {% endfor %}
  {% else %}
    {% comment %} 如果没有blocks，显示占位内容 {% endcomment %}
    <div class="background-wrapper-placeholder">
      <p style="text-align: center; padding: 2rem; color: #666;">
        请在主题编辑器中添加内容块，或在此分区下方添加其他分区
      </p>
    </div>
  {% endif %}
</div>

{% schema %}
{
  "name": "背景包装器 Background Wrapper",
  "tag": "section",
  "class": "background-wrapper-section",
  "settings": [
    {
      "type": "header",
      "content": "背景设置 Background Settings"
    },
    {
      "type": "select",
      "id": "background_type",
      "label": "背景类型 Background Type",
      "options": [
        {
          "value": "none",
          "label": "无 None"
        },
        {
          "value": "solid",
          "label": "单色 Solid Color"
        },
        {
          "value": "gradient",
          "label": "渐变 Gradient"
        }
      ],
      "default": "none"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "背景颜色 Background Color",
      "info": "仅在背景类型为单色时生效"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "渐变颜色 Gradient Colors",
      "info": "仅在背景类型为渐变时生效。可以添加多个颜色，用逗号分隔，例如: #ff0000, #00ff00, #0000ff"
    },
    {
      "type": "range",
      "id": "gradient_angle",
      "label": "渐变角度 Gradient Angle (度)",
      "min": 0,
      "max": 360,
      "step": 5,
      "default": 90,
      "unit": "°",
      "info": "渐变方向角度，0度为向右，90度为向下，180度为向左，270度为向上。步长为5度"
    },
    {
      "type": "header",
      "content": "内边距设置 Padding Settings"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "上内边距 Top Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "下内边距 Bottom Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_left",
      "label": "左内边距 Left Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_right",
      "label": "右内边距 Right Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "header",
      "content": "移动端内边距设置 Mobile Padding Settings"
    },
    {
      "type": "range",
      "id": "padding_top_mobile",
      "label": "移动端上内边距 Mobile Top Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px",
      "info": "如果为0，则使用桌面端设置"
    },
    {
      "type": "range",
      "id": "padding_bottom_mobile",
      "label": "移动端下内边距 Mobile Bottom Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px",
      "info": "如果为0，则使用桌面端设置"
    },
    {
      "type": "range",
      "id": "padding_left_mobile",
      "label": "移动端左内边距 Mobile Left Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px",
      "info": "如果为0，则使用桌面端设置"
    },
    {
      "type": "range",
      "id": "padding_right_mobile",
      "label": "移动端右内边距 Mobile Right Padding (px)",
      "min": 0,
      "max": 200,
      "step": 5,
      "default": 0,
      "unit": "px",
      "info": "如果为0，则使用桌面端设置"
    }
  ],
  "blocks": [
    {
      "type": "content",
      "name": "富文本内容 Rich Text",
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "内容 Content"
        }
      ]
    },
    {
      "type": "html",
      "name": "HTML 内容",
      "settings": [
        {
          "type": "html",
          "id": "html_content",
          "label": "HTML 内容 HTML Content"
        }
      ]
    },
    {
      "type": "liquid",
      "name": "Liquid 代码",
      "settings": [
        {
          "type": "liquid",
          "id": "liquid_content",
          "label": "Liquid 代码 Liquid Code"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "背景包装器 Background Wrapper",
      "settings": {
        "background_type": "none"
      }
    }
  ]
}
{% endschema %}

